<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>pika: A lightweight package for evaluating correlation between time series • pika</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="pika: A lightweight package for evaluating correlation between time series">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pika</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/pika_vignette.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/pika_vignette.html">pika: Evaluating Correlation Between Time Series</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/pika/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>pika: A lightweight package for evaluating correlation between time series</h1>
                        <h4 data-toc-skip class="author">Kylie
Ainslie</h4>
            
            <h4 data-toc-skip class="date">2026-01-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/pika/blob/master/vignettes/pika_vignette.Rmd" class="external-link"><code>vignettes/pika_vignette.Rmd</code></a></small>
      <div class="d-none name"><code>pika_vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><code>pika</code> is a lightweight package that enables easily
estimating the optimal lag and rolling corrleation between two time
series. This package was dveloped for use with epidemiological data and
mobility data, but can be used more generally for other time series. The
main utility of this package is the ability to determine quantities of
interest by a grouping variable, such as the rolling correlation between
two time series for different locations. This vignette goes over the
different functionality of <code>pika</code> in an epidemiological
context, namely determining the optimal lag and rolling correlation
between estimates of reproduction number (the average number of new
cases generated by a single case) and mobility within the population
within different regions of China during the COVID-19 pandemic.</p>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p><code>pika</code> contains several example data sets in the
<code>data/</code> directory that can be used to run through the package
functions. The example data sets include 1. Daily confirmed cases of
COVID-19 from different provinces in China (china_case_data) 2. Daily
within-city movement data for the same provinces in 1
(exante_movement_data)</p>
<p>The case data has daily confirmed confirmed cases for different
provinces in China from 16 January to 24 March 2020 from the dashboard
maintained by Chinese Center for Disease Prevention and Control (CCDC)
<span class="citation">[1]</span>. The CCDC dashboard collates numbers
of confirmed cases reported by national and local health commissions in
each province in mainland China, and Hong Kong SAR and Macau SAR.
Confirmed cases are defined as suspected cases, who have epidemiological
links and/or clinical symptoms, and are detected with SARS-CoV-2 by PCR
tests. However, in Hubei province, clinically diagnosed cases were
additionally included between 12 and 19 February.</p>
<p>The daily within-city movement data, used as a proxy for economic
activity, is available from 1 January to 24 March 2020 for major
metropolitan cities within each province in mainland China, Hong Kong
SAR, and Macau SAR. These data, provided by Exante Data Inc <span class="citation">[2]</span>, measured travel activity relative to the
2019 average (excluding Lunar New Year). The underlying data are based
on near real-time people movement statistics from Baidu.</p>
</div>
<div class="section level3">
<h3 id="estimate-effective-reproduction-number">Estimate effective reproduction number<a class="anchor" aria-label="anchor" href="#estimate-effective-reproduction-number"></a>
</h3>
<p>To estimate the effective reproduction number (Rt), pika has a
function <code><a href="../reference/estimate_rt.html">estimate_rt()</a></code> that provides a wrapper for
<code><a href="https://rdrr.io/pkg/EpiEstim/man/estimate_R.html" class="external-link">EpiEstim::estimate_R()</a></code> <span class="citation">[3]</span>
that enables users to estimate Rt by a grouping variable. As input
<code><a href="../reference/estimate_rt.html">estimate_rt()</a></code> takes a data frame of daily cases or deaths
by group. <code>pika</code> includes an example data set
<code>china_case_data.rda</code> that includes daily reported cases of
COVID-19 from several provinces in China between 16 January 2020 and 24
March 2020.</p>
<table class="table">
<thead><tr class="header">
<th align="left">date</th>
<th align="left">province</th>
<th align="right">cases</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2020-01-16</td>
<td align="left">Hubei</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">2020-01-16</td>
<td align="left">Guangdong</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">2020-01-16</td>
<td align="left">Zhejiang</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2020-01-16</td>
<td align="left">Henan</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">2020-01-16</td>
<td align="left">Hunan</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2020-01-16</td>
<td align="left">Beijing</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">2020-01-16</td>
<td align="left">Hong_Kong_SAR</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2020-01-17</td>
<td align="left">Hubei</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="left">2020-01-17</td>
<td align="left">Guangdong</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2020-01-17</td>
<td align="left">Zhejiang</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>To estimate Rt from case data, the user must specify the data set in
the <code>dat =</code> argument of <code><a href="../reference/estimate_rt.html">estimate_rt()</a></code>. The data
set should include three columns: a date column (this should be of class
‘date’), a grouping variable, and the value used to estimate Rt (most
commonly this is cases, but other quantities can be used, such as
deaths). The names of the columns in the input data set should be
specified as character strings in the <code>grp_var =</code>,
<code>date_var =</code>, and <code>incidence_var =</code> arguments.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># to estimate them with pika, use estimate_rt() ------------------------------------------</span></span>
<span><span class="va">rt_estimates</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_rt.html">estimate_rt</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">china_case_data</span>,</span>
<span>                            grp_var <span class="op">=</span> <span class="st">"province"</span>,</span>
<span>                            date_var <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>                            incidence_var <span class="op">=</span> <span class="st">"cases"</span></span>
<span>                            <span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="co"># a little data formatting--------------------------------------------------------------</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>province <span class="op">=</span> <span class="fu">to_snake_case</span><span class="op">(</span><span class="va">province</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="va">date_start</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span><span class="st">"date"</span> <span class="op">=</span> <span class="st">"date_end"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">date</th>
<th align="left">province</th>
<th align="right">r_mean</th>
<th align="right">r_q2.5</th>
<th align="right">r_q97.5</th>
<th align="right">r_median</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2020-01-23</td>
<td align="left">hubei</td>
<td align="right">5.158792</td>
<td align="right">4.718609</td>
<td align="right">5.618324</td>
<td align="right">5.155387</td>
</tr>
<tr class="even">
<td align="left">2020-01-24</td>
<td align="left">hubei</td>
<td align="right">4.572393</td>
<td align="right">4.232182</td>
<td align="right">4.925570</td>
<td align="right">4.570112</td>
</tr>
<tr class="odd">
<td align="left">2020-01-25</td>
<td align="left">hubei</td>
<td align="right">4.561455</td>
<td align="right">4.273269</td>
<td align="right">4.858912</td>
<td align="right">4.559824</td>
</tr>
<tr class="even">
<td align="left">2020-01-26</td>
<td align="left">hubei</td>
<td align="right">4.409607</td>
<td align="right">4.166198</td>
<td align="right">4.659828</td>
<td align="right">4.408408</td>
</tr>
<tr class="odd">
<td align="left">2020-01-27</td>
<td align="left">hubei</td>
<td align="right">6.501828</td>
<td align="right">6.246638</td>
<td align="right">6.762055</td>
<td align="right">6.500942</td>
</tr>
<tr class="even">
<td align="left">2020-01-28</td>
<td align="left">hubei</td>
<td align="right">6.117626</td>
<td align="right">5.906827</td>
<td align="right">6.332068</td>
<td align="right">6.116984</td>
</tr>
<tr class="odd">
<td align="left">2020-01-29</td>
<td align="left">hubei</td>
<td align="right">5.421957</td>
<td align="right">5.258101</td>
<td align="right">5.588293</td>
<td align="right">5.421521</td>
</tr>
<tr class="even">
<td align="left">2020-01-30</td>
<td align="left">hubei</td>
<td align="right">4.719259</td>
<td align="right">4.592553</td>
<td align="right">4.847667</td>
<td align="right">4.718960</td>
</tr>
<tr class="odd">
<td align="left">2020-01-31</td>
<td align="left">hubei</td>
<td align="right">4.086316</td>
<td align="right">3.987002</td>
<td align="right">4.186835</td>
<td align="right">4.086104</td>
</tr>
<tr class="even">
<td align="left">2020-02-01</td>
<td align="left">hubei</td>
<td align="right">3.743788</td>
<td align="right">3.662311</td>
<td align="right">3.826149</td>
<td align="right">3.743632</td>
</tr>
</tbody>
</table>
<p>The method used to estimate Rt can be changed using the
<code>est_method =</code> argument. This argument takes the following
options:
<code>c("non_parametric_si","parametric_si","uncertain_si","si_from_data","si_from_sample")</code>.
For methods that require specifying the mean and standard deviation of
the serial interval, these parameters can be set using the
<code>si_mean =</code> and <code>si_std =</code> function arguments. The
default values are <code>si_mean = 6.48</code> and
<code>si_std = 3.83</code> <span class="citation">[4]</span>.</p>
<p>For more information on the methodology underlying
<code><a href="https://rdrr.io/pkg/EpiEstim/man/estimate_R.html" class="external-link">EpiEstim::estimate_R</a></code> look at this <a href="https://cran.r-project.org/web/packages/EpiEstim/vignettes/demo.html" class="external-link">vignette</a>
or at <code>help("estimate_R")</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="lag">Lag<a class="anchor" aria-label="anchor" href="#lag"></a>
</h2>
<p>When determining the relationship between two time series it is
sometimes of interest to determine the lag at which the correlation
between the two time series is highest, we’ll call this the optimal lag.
To determine the optimal lag, the two time series must first be merged
into a single data frame. We do this below using <code>dplyr</code>’s
<code>left_join()</code> by <code>date</code> and
<code>province</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Join data sets together by date and province to determine cross correlation -----------</span></span>
<span><span class="co"># for this we are using input rt estimates, not those estimated using pika::estimate_rt()</span></span>
<span><span class="va">data_joined</span> <span class="op">&lt;-</span> <span class="fu">left_join</span><span class="op">(</span><span class="va">rt_estimates</span>,</span>
<span>                         <span class="va">exante_movement_data</span>,</span>
<span>                         by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>,<span class="st">"province"</span><span class="op">)</span></span>
<span>                         <span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="16%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="13%">
<col width="13%">
</colgroup>
<thead><tr class="header">
<th align="left">date</th>
<th align="left">province</th>
<th align="right">r_mean</th>
<th align="right">r_q2.5</th>
<th align="right">r_q97.5</th>
<th align="right">r_median</th>
<th align="right">movement</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2020-01-23</td>
<td align="left">hubei</td>
<td align="right">5.158792</td>
<td align="right">4.718609</td>
<td align="right">5.618324</td>
<td align="right">5.155387</td>
<td align="right">4.792658</td>
</tr>
<tr class="even">
<td align="left">2020-01-24</td>
<td align="left">hubei</td>
<td align="right">4.572393</td>
<td align="right">4.232182</td>
<td align="right">4.925570</td>
<td align="right">4.570112</td>
<td align="right">3.774731</td>
</tr>
<tr class="odd">
<td align="left">2020-01-25</td>
<td align="left">hubei</td>
<td align="right">4.561455</td>
<td align="right">4.273269</td>
<td align="right">4.858912</td>
<td align="right">4.559824</td>
<td align="right">2.573851</td>
</tr>
<tr class="even">
<td align="left">2020-01-26</td>
<td align="left">hubei</td>
<td align="right">4.409607</td>
<td align="right">4.166198</td>
<td align="right">4.659828</td>
<td align="right">4.408408</td>
<td align="right">2.020488</td>
</tr>
<tr class="odd">
<td align="left">2020-01-27</td>
<td align="left">hubei</td>
<td align="right">6.501828</td>
<td align="right">6.246638</td>
<td align="right">6.762055</td>
<td align="right">6.500942</td>
<td align="right">1.876848</td>
</tr>
<tr class="even">
<td align="left">2020-01-28</td>
<td align="left">hubei</td>
<td align="right">6.117626</td>
<td align="right">5.906827</td>
<td align="right">6.332068</td>
<td align="right">6.116984</td>
<td align="right">1.817556</td>
</tr>
<tr class="odd">
<td align="left">2020-01-29</td>
<td align="left">hubei</td>
<td align="right">5.421957</td>
<td align="right">5.258101</td>
<td align="right">5.588293</td>
<td align="right">5.421521</td>
<td align="right">1.766298</td>
</tr>
<tr class="even">
<td align="left">2020-01-30</td>
<td align="left">hubei</td>
<td align="right">4.719259</td>
<td align="right">4.592553</td>
<td align="right">4.847667</td>
<td align="right">4.718960</td>
<td align="right">1.662975</td>
</tr>
<tr class="odd">
<td align="left">2020-01-31</td>
<td align="left">hubei</td>
<td align="right">4.086316</td>
<td align="right">3.987002</td>
<td align="right">4.186835</td>
<td align="right">4.086104</td>
<td align="right">1.603111</td>
</tr>
<tr class="even">
<td align="left">2020-02-01</td>
<td align="left">hubei</td>
<td align="right">3.743788</td>
<td align="right">3.662311</td>
<td align="right">3.826149</td>
<td align="right">3.743632</td>
<td align="right">1.546469</td>
</tr>
</tbody>
</table>
<p>We can then identify the optimal lag by calculating the cross
correlation between the two time series by the grouping variable at
different lags using the <code>cross_corr</code> function. The argument
<code>max_lag =</code> specifies the maximum lag to test. In the below
example it is set to 10 days. The <code>subset_date =</code> argument
allows the user to determine the cross correlation between the two time
series for a subset of the time window.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># # Determine lag with max cross correlation between Rt and movement ----------------------</span></span>
<span><span class="va">lags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cross_corr.html">cross_corr</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">data_joined</span>,</span>
<span>                   date_var <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>                   grp_var <span class="op">=</span> <span class="st">"province"</span>,</span>
<span>                   x_var <span class="op">=</span> <span class="st">"r_mean"</span>,</span>
<span>                   y_var <span class="op">=</span> <span class="st">"movement"</span>,</span>
<span>                   max_lag <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                   subset_date <span class="op">=</span> <span class="st">"2020-02-15"</span></span>
<span>                  <span class="op">)</span></span>
<span></span>
<span><span class="co"># use min lag across groups -------------------------------------------------------------</span></span>
<span><span class="va">my_lag</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">lags</span><span class="op">$</span><span class="va">lag</span><span class="op">)</span></span></code></pre></div>
<p>Once the optimal lag is determined, we must back date our Rt
estimates without impacting the date of the movement variable.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create lag date using max lag from cross_corr() ---------------------------------------</span></span>
<span><span class="va">data_joined_lag</span> <span class="op">&lt;-</span> <span class="va">rt_estimates</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>date <span class="op">=</span> <span class="va">date</span> <span class="op">+</span> <span class="va">my_lag</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">.</span>, <span class="va">exante_movement_data</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"date"</span>, <span class="st">"province"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="percent-change-relative-to-baseline">Percent change relative to baseline<a class="anchor" aria-label="anchor" href="#percent-change-relative-to-baseline"></a>
</h2>
<p>Sometimes, it is of interest to convert a count variable over time
into a percent change based on the average value in a specified baseline
period. Using <code><a href="../reference/calc_percent_change.html">calc_percent_change()</a></code> users can specify a
baseline period that will them be used to determine the percent change
in their count variable time series. This function was written for
application to mobility data, where the percent change in mobility over
time relative to baseline is of interest. However, this function can be
applied to any count type time series.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">perc_change_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_percent_change.html">calc_percent_change</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">exante_movement_data</span>,</span>
<span>                                        date_var <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>                                        grp_var <span class="op">=</span> <span class="st">"province"</span>, </span>
<span>                                        count_var <span class="op">=</span> <span class="st">"movement"</span>, </span>
<span>                                        n_baseline_periods <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">date</th>
<th align="left">province</th>
<th align="right">movement</th>
<th align="right">perc_change</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2020-01-01</td>
<td align="left">anhui</td>
<td align="right">5.131897</td>
<td align="right">0.9674739</td>
</tr>
<tr class="even">
<td align="left">2020-01-02</td>
<td align="left">anhui</td>
<td align="right">5.585968</td>
<td align="right">1.0530762</td>
</tr>
<tr class="odd">
<td align="left">2020-01-03</td>
<td align="left">anhui</td>
<td align="right">5.675878</td>
<td align="right">1.0700261</td>
</tr>
<tr class="even">
<td align="left">2020-01-04</td>
<td align="left">anhui</td>
<td align="right">5.191629</td>
<td align="right">0.9787347</td>
</tr>
<tr class="odd">
<td align="left">2020-01-05</td>
<td align="left">anhui</td>
<td align="right">4.821942</td>
<td align="right">0.9090406</td>
</tr>
<tr class="even">
<td align="left">2020-01-06</td>
<td align="left">anhui</td>
<td align="right">5.421992</td>
<td align="right">1.0221631</td>
</tr>
<tr class="odd">
<td align="left">2020-01-07</td>
<td align="left">anhui</td>
<td align="right">5.301700</td>
<td align="right">0.9994855</td>
</tr>
<tr class="even">
<td align="left">2020-01-08</td>
<td align="left">anhui</td>
<td align="right">5.636145</td>
<td align="right">1.0625356</td>
</tr>
<tr class="odd">
<td align="left">2020-01-09</td>
<td align="left">anhui</td>
<td align="right">5.463023</td>
<td align="right">1.0298983</td>
</tr>
<tr class="even">
<td align="left">2020-01-10</td>
<td align="left">anhui</td>
<td align="right">5.633986</td>
<td align="right">1.0621285</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="rolling-correlation">Rolling correlation<a class="anchor" aria-label="anchor" href="#rolling-correlation"></a>
</h2>
<p>It is often of interest to determine the relationship between two
time series, specifically the rolling correlation. The
<code><a href="../reference/rolling_corr.html">rolling_corr()</a></code> function calculates the rolling correlation
between two times series (<code>x_var</code> and <code>y_var</code>)
over a specified time window <code>n =</code>. Here, we calculate the
biweekly rolling correlation between Rt and movement. Since our data is
daily estimates of Rt and movement, we set <code>n = 14</code>. If our
data was monthly and we wanted to determine a 6 month rolling
correlation, we would set <code>n = 6</code>. The output of
<code><a href="../reference/rolling_corr.html">rolling_corr()</a></code> is a data frame with an additional column
added to the input dataset called “rolling_corr”. Depending on the value
of <code>n</code>, the first <code>n</code> values of “rolling_corr” are
NA.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Determine rolling correlation between Rt and movement ---------------------------------</span></span>
<span><span class="va">data_corr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rolling_corr.html">rolling_corr</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">data_joined_lag</span>,</span>
<span>                          date_var <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>                          grp_var <span class="op">=</span> <span class="st">"province"</span>,</span>
<span>                          x_var <span class="op">=</span> <span class="st">"r_mean"</span>,</span>
<span>                          y_var <span class="op">=</span> <span class="st">"movement"</span>,</span>
<span>                          n <span class="op">=</span> <span class="fl">14</span><span class="op">)</span></span></code></pre></div>
<p>To visualise the rolling correlation, the results of
<code><a href="../reference/rolling_corr.html">rolling_corr()</a></code> can be plotted using
<code><a href="../reference/plot_corr.html">plot_corr()</a></code>. This creates a plot of the two time series and
the rolling correlation between them facetted by grouping variable.
There are optional arguments to change the facet labels
(<code>facet_lables =</code>), legend_labels
(<code>legend_labels =</code>), add confidence bounds for the primary
time series (<code>x_var_lower =</code> and <code>x_var_upper =</code>),
and set a maximum value for the y-axis (<code>y_max =</code>). The below
code plots the mean Rt estimates with 95% confidence bands, movement
index, and the biweekly correlation between them. We also specify custom
facet and legend labels and restrict the y-axis to a maximum value of
10.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot Rt, movement, and correlation ----------------------------------------------------</span></span>
<span><span class="va">my_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"beijing"</span> <span class="op">=</span> <span class="st">"Beijing"</span>, <span class="st">"guangdong"</span> <span class="op">=</span> <span class="st">"Guangdong"</span>, <span class="st">"henan"</span> <span class="op">=</span> <span class="st">"Henan"</span>,</span>
<span>               <span class="st">"hong_kong_sar"</span> <span class="op">=</span> <span class="st">"Hong Kong SAR"</span>, <span class="st">"hubei"</span> <span class="op">=</span> <span class="st">"Hubei"</span>, <span class="st">"hunan"</span> <span class="op">=</span> <span class="st">"Hunan"</span>,</span>
<span>               <span class="st">"zhejiang"</span> <span class="op">=</span> <span class="st">"Zhejiang"</span><span class="op">)</span></span>
<span><span class="va">my_legend</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Correlation"</span>, <span class="st">"Reproduction Number"</span>, <span class="st">"Movement"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_corr.html">plot_corr</a></span><span class="op">(</span>dat <span class="op">=</span> <span class="va">data_corr</span>,</span>
<span>          date_var <span class="op">=</span> <span class="st">"date"</span>,</span>
<span>          grp_var <span class="op">=</span> <span class="st">"province"</span>,</span>
<span>          x_var <span class="op">=</span> <span class="st">"r_mean"</span>,</span>
<span>          y_var <span class="op">=</span> <span class="st">"movement"</span>,</span>
<span>          x_var_lower <span class="op">=</span> <span class="st">"r_q2.5"</span>,</span>
<span>          x_var_upper <span class="op">=</span> <span class="st">"r_q97.5"</span>,</span>
<span>          facet_labels <span class="op">=</span> <span class="va">my_labels</span>,</span>
<span>          legend_labels <span class="op">=</span> <span class="va">my_legend</span>,</span>
<span>          y_max <span class="op">=</span> <span class="fl">10</span></span>
<span>          <span class="op">)</span></span></code></pre></div>
<p><img src="pika_vignette_files/figure-html/unnamed-chunk-1-1.png" class="r-plt" alt="" width="768"></p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body">
<div id="ref-noauthor_2020-pv" class="csl-entry">
<div class="csl-left-margin">1. </div>
<div class="csl-right-inline">Distribution of the novel coronavirus-infected
pneumonia [chinese]. <a href="http://2019ncov.chinacdc.cn/2019-nCoV/" class="external-link uri">http://2019ncov.chinacdc.cn/2019-nCoV/</a>; 2020. </div>
</div>
<div id="ref-Exante_Data_Inc2020-mo" class="csl-entry">
<div class="csl-left-margin">2. </div>
<div class="csl-right-inline">Exante Data Inc. 114 E 25th Street New York, NY
10010 USA; 2020. </div>
</div>
<div id="ref-Cori2019-sc" class="csl-entry">
<div class="csl-left-margin">3. </div>
<div class="csl-right-inline">Cori
A. <span>EpiEstim</span>: Estimate time varying reproduction numbers
from epidemic curves. 2019. </div>
</div>
<div id="ref-Ferguson_undated-yc" class="csl-entry">
<div class="csl-left-margin">4. </div>
<div class="csl-right-inline">Ferguson NM, Laydon D, Nedjati-Gilani G, Imai
N, Ainslie K, Baguelin M, et al. Impact of non-pharmaceutical
interventions (<span>NPIs</span>) to reduce <span>COVID-19</span>
mortality and healthcare demand. </div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://orcid.org/0000-0001-5419-7206" class="external-link">Kylie Ainslie</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
